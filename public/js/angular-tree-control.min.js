"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="treeControl"),function(e){"use strict";function o(e){return function(){for(var o,n=[],t=e;t&&t.node!==e.synteticRoot;)o!==t.node&&n.push(t.node),o=t.node,t=t.$parent;return n}}function n(e,o,n){e.hasOwnProperty(o)||(e[o]=n)}function t(e,o){return!e[o.options.nodeChildren]||0===e[o.options.nodeChildren].length}function s(o,n){if(e.isArray(o)){n=n||[];for(var t=0;t<o.length;t++)n[t]=o[t]}else if(e.isObject(o)){n=n||{};for(var s in o)!hasOwnProperty.call(o,s)||"$"===s.charAt(0)&&"$"===s.charAt(1)||(n[s]=o[s])}return n||o}function d(o,n,t){return!(!o||!n)&&(o=s(o),o[t.options.nodeChildren]=[],n=s(n),n[t.options.nodeChildren]=[],e.equals(o,n))}function i(){return!0}function l(e){n(e.options,"multiSelection",!1),n(e.options,"nodeChildren","children"),n(e.options,"dirSelectable","true"),n(e.options,"injectClasses",{}),n(e.options.injectClasses,"ul",""),n(e.options.injectClasses,"li",""),n(e.options.injectClasses,"liSelected",""),n(e.options.injectClasses,"iExpanded",""),n(e.options.injectClasses,"iCollapsed",""),n(e.options.injectClasses,"iLeaf",""),n(e.options.injectClasses,"label",""),n(e.options.injectClasses,"labelSelected",""),n(e.options,"equality",d),n(e.options,"isLeaf",t),n(e.options,"allowDeselect",!0),n(e.options,"isSelectable",i)}e.module("treeControl",[]).constant("treeConfig",{templateUrl:null}).directive("treecontrol",["$compile",function(n){function t(e,o){return e?o?'class="'+e+'"':e:""}return{restrict:"EA",require:"treecontrol",transclude:!0,scope:{treeModel:"=",selectedNode:"=?",selectedNodes:"=?",expandedNodes:"=?",onSelection:"&",onNodeToggle:"&",options:"=?",orderBy:"=?",reverseOrder:"@",filterExpression:"=?",filterComparator:"=?"},controller:["$scope","$templateCache","$interpolate","treeConfig",function(e,s,d,i){function r(o){if(!e.options.multiSelection&&e.options.equality(o,e.selectedNode,e))return!0;if(e.options.multiSelection&&e.selectedNodes){for(var n=0;n<e.selectedNodes.length;n++)if(e.options.equality(o,e.selectedNodes[n],e))return!0;return!1}}e.options=e.options||{},l(e),e.selectedNodes=e.selectedNodes||[],e.expandedNodes=e.expandedNodes||[],e.expandedNodesMap={};for(var a=0;a<e.expandedNodes.length;a++)e.expandedNodesMap["a"+a]=e.expandedNodes[a];e.parentScopeOfTree=e.$parent,e.headClass=function(o){var n=t(e.options.injectClasses.liSelected,!1),s="";return n&&r(o)&&(s=" "+n),e.options.isLeaf(o,e)?"tree-leaf"+s:e.expandedNodesMap[this.$id]?"tree-expanded"+s:"tree-collapsed"+s},e.iBranchClass=function(){return t(e.expandedNodesMap[this.$id]?e.options.injectClasses.iExpanded:e.options.injectClasses.iCollapsed)},e.nodeExpanded=function(){return!!e.expandedNodesMap[this.$id]},e.selectNodeHead=function(){var n=this,t=void 0===e.expandedNodesMap[n.$id];if(e.expandedNodesMap[n.$id]=t?n.node:void 0,t)e.expandedNodes.push(n.node);else{for(var s,d=0;d<e.expandedNodes.length&&!s;d++)e.options.equality(e.expandedNodes[d],n.node,e)&&(s=d);void 0!==s&&e.expandedNodes.splice(s,1)}if(e.onNodeToggle){var i=n.$parent.node===n.synteticRoot?null:n.$parent.node,l=o(n);e.onNodeToggle({node:n.node,$parentNode:i,$path:l,$index:n.$index,$first:n.$first,$middle:n.$middle,$last:n.$last,$odd:n.$odd,$even:n.$even,expanded:t})}},e.selectNodeLabel=function(n){var t=this;if(e.options.isLeaf(n,e)||e.options.dirSelectable&&e.options.isSelectable(n)){if(e.options.isLeaf(n,e)&&!e.options.isSelectable(n))return;var s=!1;if(e.options.multiSelection){for(var d=-1,i=0;i<e.selectedNodes.length;i++)if(e.options.equality(n,e.selectedNodes[i],e)){d=i;break}-1===d?(e.selectedNodes.push(n),s=!0):e.selectedNodes.splice(d,1)}else e.options.equality(n,e.selectedNode,e)&&e.options.allowDeselect?e.selectedNode=void 0:(e.selectedNode=n,s=!0);if(e.onSelection){var l=t.$parent.node===t.synteticRoot?null:t.$parent.node,r=o(t);e.onSelection({node:n,selected:s,$parentNode:l,$path:r,$index:t.$index,$first:t.$first,$middle:t.$middle,$last:t.$last,$odd:t.$odd,$even:t.$even})}}else this.selectNodeHead()},e.selectedClass=function(){var o=r(this.node),n=t(e.options.injectClasses.labelSelected,!1),s="";return n&&o&&(s=" "+n),o?"tree-selected"+s:""},e.unselectableClass=function(){var o=!e.options.isSelectable(this.node),n=t(e.options.injectClasses.labelUnselectable,!1);return o?"tree-unselectable "+n:""},e.isReverse=function(){return!("false"===e.reverseOrder||"False"===e.reverseOrder||""===e.reverseOrder||!1===e.reverseOrder)},e.orderByFunc=function(){return e.orderBy};var c,p={orderBy:e.orderBy?" | orderBy:orderByFunc():isReverse()":"",ulClass:t(e.options.injectClasses.ul,!0),nodeChildren:e.options.nodeChildren,liClass:t(e.options.injectClasses.li,!0),iLeafClass:t(e.options.injectClasses.iLeaf,!1),labelClass:t(e.options.injectClasses.label,!1)},u=e.options.templateUrl||i.templateUrl;u&&(c=s.get(u)),c||(c='<ul {{options.ulClass}} ><li ng-repeat="node in node.{{options.nodeChildren}} | filter:filterExpression:filterComparator {{options.orderBy}}" ng-class="headClass(node)" {{options.liClass}}set-node-to-data><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i><i class="tree-leaf-head {{options.iLeafClass}}"></i><div class="tree-label {{options.labelClass}}" ng-class="[selectedClass(), unselectableClass()]" ng-click="selectNodeLabel(node)" tree-transclude></div><treeitem ng-if="nodeExpanded()"></treeitem></li></ul>'),this.template=n(d(c)({options:p}))}],compile:function(o,n,t){return function(o,n,s,d){o.$watch("treeModel",function(n){if(e.isArray(n)){if(e.isDefined(o.node)&&e.equals(o.node[o.options.nodeChildren],n))return;o.node={},o.synteticRoot=o.node,o.node[o.options.nodeChildren]=n}else{if(e.equals(o.node,n))return;o.node=n}}),o.$watchCollection("expandedNodes",function(t,s){var d=0,i={},l=n.find("li"),r=[];e.forEach(l,function(o){var n=e.element(o),t={$id:n.data("scope-id"),node:n.data("node")};r.push(t)}),e.forEach(t,function(e){for(var n=!1,t=0;t<r.length&&!n;t++){var s=r[t];o.options.equality(e,s.node,o)&&(i[s.$id]=s.node,n=!0)}n||(i["a"+d++]=e)}),o.expandedNodesMap=i}),d.template(o,function(e){n.html("").append(e)}),o.$treeTransclude=t}}}}]).directive("setNodeToData",["$parse",function(e){return{restrict:"A",link:function(e,o,n){o.data("node",e.node),o.data("scope-id",e.$id)}}}]).directive("treeitem",function(){return{restrict:"E",require:"^treecontrol",link:function(e,o,n,t){t.template(e,function(e){o.html("").append(e)})}}}).directive("treeTransclude",function(){return{controller:["$scope",function(e){l(e)}],link:function(n,t,s,d){if(n.options.isLeaf(n.node,n)||e.forEach(n.expandedNodesMap,function(e,o){n.options.equality(e,n.node,n)&&(n.expandedNodesMap[n.$id]=n.node,n.expandedNodesMap[o]=void 0)}),!n.options.multiSelection&&n.options.equality(n.node,n.selectedNode,n))n.selectedNode=n.node;else if(n.options.multiSelection){for(var i=[],l=0;l<n.selectedNodes.length;l++)n.options.equality(n.node,n.selectedNodes[l],n)&&i.push(n.node);n.selectedNodes=i}n.transcludeScope=n.parentScopeOfTree.$new(),n.transcludeScope.node=n.node,n.transcludeScope.$path=o(n),n.transcludeScope.$parentNode=n.$parent.node===n.synteticRoot?null:n.$parent.node,n.transcludeScope.$index=n.$index,n.transcludeScope.$first=n.$first,n.transcludeScope.$middle=n.$middle,n.transcludeScope.$last=n.$last,n.transcludeScope.$odd=n.$odd,n.transcludeScope.$even=n.$even,n.$on("$destroy",function(){n.transcludeScope.$destroy()}),n.$treeTransclude(n.transcludeScope,function(e){t.empty(),t.append(e)})}}})}(angular);